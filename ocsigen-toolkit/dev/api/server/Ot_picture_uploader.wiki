=Module <<a_api_type subproject="server" | module Ot_picture_uploader >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Ot_picture_uploader>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Ot_picture_uploader >><<span class="ocsforge_color_keyword"|end>>>>~Picture uploader widget

----

<<span class="odocwiki_inlinecode"|~Ot~_picture~_uploader>> allow the user to see a picture he wants to
    send to the before sending it server~.  ~Also~, controllers can be
    added to allow the user to specify a cropping area~. ~No cropping is
    actually done on the client side~, it ~M~U~S~T be handled on server
    side by a service~.
<<pre class="ocsforge_color odocwiki_code" id="TYPEservice"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_type"|'a>> <<span class="odocwiki_name"|service>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit,\\   'a * <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>float * float * float * float<<span class="ocsforge_color_delimiter"| ) >> option * <<span class="ocsforge_color_uid"|Eliom_lib>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|file_info>><<span class="ocsforge_color_delimiter"| ) >>,\\   <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|post>>, <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|non_att>>, <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|co>>,\\   <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|non_ext>>, <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|reg>>, [ `WithoutSuffix ], unit,\\   [ `One of 'a <<span class="ocsforge_color_uid"|Eliom_parameter>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ocaml>> ] <<span class="ocsforge_color_uid"|Eliom_parameter>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|param_name>> *\\   <<span class="ocsforge_color_delimiter"| ( >>[ `One of\\        <<span class="ocsforge_color_delimiter"| ( >>float * float * float * float<<span class="ocsforge_color_delimiter"| ) >> option <<span class="ocsforge_color_uid"|Eliom_parameter>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ocaml>> ]\\    <<span class="ocsforge_color_uid"|Eliom_parameter>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|param_name>> *\\    [ `One of <<span class="ocsforge_color_uid"|Eliom_lib>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|file_info>> ] <<span class="ocsforge_color_uid"|Eliom_parameter>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|param_name>><<span class="ocsforge_color_delimiter"| ) >>,\\   unit <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ocaml>><<span class="ocsforge_color_delimiter"| ) >>\\  <<span class="ocsforge_color_uid"|Eliom_service>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>> >>
<<span class="odocwiki_inlinecode"| let ~(reset~, cropping~, cropper~_dom~) ~= cropper ~~image ~(~) >>
    <<span class="odocwiki_inlinecode"| reset >> is function to call to reset the current cropper status
    <<span class="odocwiki_inlinecode"| cropping >> are current cropping parameters
    <<span class="odocwiki_inlinecode"| cropper~_dom >> is the div containing cropping controllers

<<span class="odocwiki_inlinecode"|bind~_input input preview ~?container ~?reset ~(~)>>
    ~Bind <<span class="odocwiki_inlinecode"|input>> and <<span class="odocwiki_inlinecode"|preview>> so the file selected in <<span class="odocwiki_inlinecode"|input>> is the
    image displayed in <<span class="odocwiki_inlinecode"|preview>>~.
    <<span class="odocwiki_inlinecode"|~?container>> is used to toggle <<span class="odocwiki_inlinecode"|ot~-no~-file>> class~.
    <<span class="odocwiki_inlinecode"|~?reset>> is called when the <<span class="odocwiki_inlinecode"|input>> value changes~.

<<span class="odocwiki_inlinecode"| do~_submit input ~?cropping ~~service ~~arg ~(~) >>
    <<span class="odocwiki_inlinecode"|input>> is the input with file loaded
    <<span class="odocwiki_inlinecode"|cropping>> are cropping info
    <<span class="odocwiki_inlinecode"|service>> service used for submission
    <<span class="odocwiki_inlinecode"|arg>> extra argument passed to <<span class="odocwiki_inlinecode"|service>> ~(as first argument~)

<<span class="odocwiki_inlinecode"| bind~_submit input button ~?cropping ~~service ~~arg ~~after~_submit ~(~) >>
    ~Make <<span class="odocwiki_inlinecode"| button >> action is to call <<span class="odocwiki_inlinecode"|service>> with
    <<span class="odocwiki_inlinecode"| ~(arg~, ~(cropping~, file~)~) >> parameters~, <<span class="odocwiki_inlinecode"| file >> being the file select in
    <<span class="odocwiki_inlinecode"| input >>~.
    <<span class="odocwiki_inlinecode"| after~_submit >> is called once <<span class="odocwiki_inlinecode"| service >> returned~.

<<span class="odocwiki_inlinecode"|bind>> is a shortcut for <<span class="odocwiki_inlinecode"|bind~_input>> and <<span class="odocwiki_inlinecode"|bind~_submit>> actions
<<pre id="VALinput" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|input>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?a: >>[< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|label_attrib>> > `Class ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|attrib>>\\     list <<span class="ocsforge_color_delimiter"| -> >>\\  [< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|label_content_fun>> ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> list <<span class="ocsforge_color_delimiter"| -> >>\\  [> `Input ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> *\\  [> `Label ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>>>>>><<div class="odocwiki_info"|~Create a file input element with good input type <<span class="odocwiki_inlinecode"|ot~-pup~-input>> class
    and wrap it into a label~.
    ~Return ~(input node~, label node~)
>>
<<pre id="VALpreview" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|preview>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?a: >>[< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|img_attrib>> > `Class ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|attrib>> list <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> [> `Img ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>>>>>><<div class="odocwiki_info"|~Create a img element with no src~, no alt and <<span class="odocwiki_inlinecode"|ot~-pup~-preview>> class~.
>>
<<pre id="VALsubmit" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|submit>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?a: >>[< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|button_attrib>> > `Class ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|attrib>>\\     list <<span class="ocsforge_color_delimiter"| -> >>\\  [< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|button_content>> ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> list <<span class="ocsforge_color_delimiter"| -> >>\\  [> `Button ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>>>>>><<div class="odocwiki_info"|~Create a button with <<span class="odocwiki_inlinecode"|ot~-pup~-sumit>> clas
>>
<<pre id="VALmk_service" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|mk~_service>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Deriving_Json>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> 'a <<a_api subproject="server" text="service" | type Ot_picture_uploader.service >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|mk~_service name arg~_deriver>>
    ~Create a named service taking <<span class="odocwiki_inlinecode"|~(arg~_deriver~, ~(cropping~, file~)~)>> parameter
>>
<<pre id="VALmk_form" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|mk~_form>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?after_submit: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?crop: >>float option <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?input: >>[< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|label_attrib>> > `Class ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|attrib>>\\         list *\\         [< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|label_content_fun>> ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> list <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?submit: >>[< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|button_attrib>> > `Class ]\\          <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|attrib>> list *\\          [< <<span class="ocsforge_color_uid"|Html_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|button_content_fun>> ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> list <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<a_api subproject="server" text="service" | type Ot_picture_uploader.service >> <<span class="ocsforge_color_delimiter"| -> >>\\  'a <<span class="ocsforge_color_delimiter"| -> >> [> `Form ] <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Ready~-to~-use form~, using <<span class="odocwiki_inlinecode"|service>> and <<span class="odocwiki_inlinecode"|arg>>~. ~Customizable with
    <<span class="odocwiki_inlinecode"|input>>~, the input button content~, <<span class="odocwiki_inlinecode"|submit>>~, the submit button content~.
    ~If <<span class="odocwiki_inlinecode"|crop>> is present~, cropping is enable~, with the optional ratio it is~.
>>
